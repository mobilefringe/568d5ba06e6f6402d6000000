<section class="page_banner">
    <div class = "inside_container">
        <div id="header_container">
            <script id="header_template" type="x-tmpl-mustache/text">
                <h2 class="text-center inside_main_header">{{title}}</h2>
                <p class="text-center desc banner_text">{{author}}</p> 
            </script>    
        </div>    
    </div>
</section>
<section class="main_content">
    <div class="inside_container">
        <div class="row">
            <main class="col-md-8">
                <div id="main_container">
                    <script id="main_template" type="x-tmpl-mustache/text">
                        <figure id="feature_image">
                            <img src="{{image}}"/>
                        </figure>
                        <div id="mm_post_content">{{content}}</div>  
                    </script>    
                </div>
            </main>
            <aside class="col-md-4">
                <div class="hidden-xs hidden-s features_container">
                    <h4>Other Features</h4>
                    <ul>
                        <!-- Dynamically pull in list of Features-->
                        <li><a href="" target="_"><i class="material-icons">check_circle</i>Feature</a></li>
                        <li><a><i class="material-icons">check_circle</i>Feature</a></li>
                        <li><a><i class="material-icons">check_circle</i>Feature</a></li>  
                    </ul>
                </div>
                <div class="contact_container">
                    <h3>Ready to Discuss?</h3>
                    <div class="contact_info">
                        <i class="material-icons contact_icon">phone</i>
                        <h6 class="phone">1-888-854-5797 ext 108</h6>
                    </div>
                    <div class="contact_info">
                        <i class="material-icons contact_icon">email</i>
                        <a href="mailto:contact@mobilefringe.com">contact@mobilefringe.com</a>
                    </div>    
                    <a href="#contact"><h5>Contact Us</h5></a>
                    <hr>
                </div>
                <button class="download_btn" type="button"><i class="material-icons">file_download</i><span>Download PDF</span></button>
            </aside>      
        </div>
    </div>    
</section>
<script>
    $(document).ready(function(e) {
        init(e);
        function renderAll (){
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            var post = getBlogDataBySlug('home-features');
            console.log(post);
            var posts = getAllPublishedPosts();
            console.log(posts);
            // var published_posts = sortByKey(posts, 'publish_date').reverse().slice(0, 4);
            // renderPosts("#side_blog_container", "#side_blog_template", published_posts);
            // renderPostDetails("#post_container", "#post_template", post);
            // var blogs = getBlogList();
            // renderBlogs("#blog_links_container", "#blog_links_template", blogs);
            // show_content();
            // blog_searcher();
            renderHeaderDetails("#header_container", "#header_template", posts);
            renderPostDetails("#post_container", "#post_template", posts);
        }
        
        function renderHeaderDetails(header_container, header_template, posts){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(header_template).html();
            $.each(posts, function(key, val) {
                if(val.title.length >0){
                    val.title = val.title;
                }
                if(val.author.length > 0){
                    val.author = val.author;
                }
                var rendered = Mustache.render(template_html,val);
                item_rendered.push(rendered);
            });
            $(header_container).html(item_rendered.join(''));
        }
        
        function renderPostDetails(post_container, post_template, posts){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(post_template).html();
            $.each(posts, function(key, val) {
                // if (val.image_url.indexOf('missing.png') > -1) {
                //     val.post_image = "//codecloud.cdn.speedyrails.net/sites/55bba30d6e6f64157e000000/eed38d089cd6373b1b6fe6579119ae92/46998083431386.Gxbjj42J5GPwa7QBEyyM_height640.png";
                // } else {
                    val.image = val.image_url;
                // }
                // if(val.body.length > 100){
                //     val.description_short = val.body.substring(0,100) + "...";
                // }
                // else{
                //     val.description_short = val.body;
                // }
                // var date_blog = moment(val.publish_date).tz(getPropertyTimeZone());
                // val.published_on = date_blog.format("MMMM D, YYYY")
                // var next_p = getNextPublishedPostBySlug(val.slug);
                // var prev_p = getPrevPublishedPostBySlug(val.slug);
                // if (next_p == undefined){
                //     val.next_post_show = "display:none";
                // }
                // else{
                //     val.next_post = next_p.title;
                //     val.next_slug = next_p.slug;
                //     val.next_post_show = "display:inline-block";
                // }
                // if (prev_p == undefined){
                //     val.prev_post_show = "display:none";
                // }
                // else{
                //     val.prev_post = prev_p.title;
                //     val.prev_slug = prev_p.slug;
                //     val.prev_post_show = "display:inline-block";
                // }
                
                // if (val.tag != undefined){
                //     val.tag_list = val.tag.join(', ');
                // }
                // var rendered = Mustache.render(template_html,val);
                // item_rendered.push(rendered);
            });
            
            $(post_container).html(item_rendered.join(''));
        }
        loadMallDataCached(renderAll); 
		
    });
</script>